프락시
=

웹 프락시 서버는 클라이언트의 입장에서 트랜잭션을 수행하는 중개인이다.
HTTP 프락시 서버는 웹 서버이기도 하고 웹 클라이언트이기도 하다.

![image](https://user-images.githubusercontent.com/70934609/107885362-3783ba00-6f3d-11eb-9461-f0487c384a60.png)

## 프락시 서버 배치


![image](https://user-images.githubusercontent.com/70934609/107885516-18395c80-6f3e-11eb-8de2-ec7256950d1e.png)


1. 출구 프락시

로컬 네트워크의 출구에 위치한다. 회사 밖의 악의적인 해커들을 막는 방화벽 제공이나 인터넷 요금 절약, 트래픽 성능 개선을 위해 사용한다.

2. 접근 프락시

고객으로부터의 모든 요청을 종합적으로 처리하기 위해 ISP 접근 지점에 위치하기도 한다. 사용자들의 다운로드 속도를 개선하고 인터넷 대역폭 비용을 줄이기 위해 캐시 프락시를 사용해 많이 찾는 문서들의 사본을 저장한다.

```
ISP란?

여기서의 ISP는 Internet Service Provider를 의미한다. 간단하게 인터넷 서비스를 제공하는 회사
```

3. 대리 프락시

네트워크의 가장 끝에 있는 웹 서버들의 바로 앞에 위치한다. 웹 서버로 들어오는 모든 요청을 처리하고 필요할 때만 웹 서버에게 자원을 요청할 수 있다.

웹 서버에 보안 기능을 추가하거나 빠른 웹 서버 캐시를 놓음으로써 성능을 개선할 수도 있다. 스스로를 웹 서버로 가장하기 때문에 모든 요청은 웹 서버 이전에 이 프락시로 오게 된다.

4. 네트워크 교환 프락시

분한 처리 능력을 갖춘 프락시가 네트워크 사이의 인터넷 피어링 교환 지점들에 놓일 수 있다. 캐시를 이용해 인터넷 교차로의 혼잡을 완화하고 트래픽 흐름을 감시한다.

*피어링(peering)은 ISP끼리 서로 네트워크를 연결하고 트래픽을 교환하는 것을 의미한다.*

프락시가 트래픽을 처리하는 방법
-

![image](https://user-images.githubusercontent.com/70934609/107885726-4bc8b680-6f3f-11eb-93f1-a89bd85a6dae.png)

- 클라이언트 수정 : 크롬을 비롯한 브라우저들은 수동 혹은 자동 프락시 설정을 지원한다. 클라이언트가 프락시를 사용하도록 설정되어 있다면, 클라이언트는 HTTP 요청을 바로 그리고 의도적으로 프락시로 보낸다.

- 네트워크 수정 : 클라이언트가 눈치 챌수 없도록 네트워크 인프라를 가로채서 웹 트래픽을 프락시로 가도록 하는 몇가지 기법이 있다. 이것을 인터셉트 프락시라 한다.

- DNS 이름공간 수정 : 웹서버 앞에 있는 대리 프락시는 웹 서버의 이름과 IP주소를 직접 사용한다. 그래서 모든 요청은 대리 프락시를 거쳐서 가게된다. 즉 DNS 이름 테이블을 수동 편집하거나, 적절한 프락시 서버를 계산해주는 특별한 동적 DNS 서버를 이용해서 조정 될 수있다.

- 웹 서버 수정 : HTTP 리다이렉션 명령을 클라이언트에게 돌려줌으로써 클라이언트의 요청을 프락시로 리다이렉트 하도록 설정 할수 있다.

## 프락시 URI는 서버 URI와 다르다

웹 서버와 웹 프락시 메시지의 문법은 서로 같지만, 한 가지 예외가 있다. 클라이언트가 프락시 대신 서버로 요청을 보내면 요청의 URI가 달라진다.

서버로 보낼때와 달리 프락시로 요청을 보낼 때, 요청줄은 완전한 URI를 갖는다.

목적지 서버와 커넥션을 맺어야 하기 떄문에, 서버의 이름을 알 필요가 있었다.
프락시가 부상할 당시, 이미 너무 많은 서버가 배치되어 있었고 완전한 URI를 보낼 필요가 있었다.

### 프락시는 프락시 요청과 서버 요청을 모두 다룰 수 있다.

다목적 프락시 서버는 완전 URI와 부분 URI를 모두 지원해야 한다.

- 완전한 URI가 주어졌다면, 프락시는 그것을 사용해야 한다.
- 부분 URI가 주어졌고 Host 헤더가 있다면, Host 헤더를 이용해 원 서버의 이름과 포트 번호를 알아내야 한다.
- 부분 URI가 주어졌으나 Host 헤더가 없다면, 다음의 방법으로 원 서버를 알아내야 한다.
    - 대리 프락시라면, 프락시에 실제 서버의 주소와 포트 번호가 설정되어 있을 수 있다.
    - 이전에 어떤 인터셉트 프락시가 가로챘던 트래픽을 받았고, 그 인터셉트 프락시가 원 IP 주소와 포트번호를 사용할 수 있도록 해두었다면, 그 IP 주소와 포트번호를 사용할 수 있다.
    - 모두 실패했다면, 에러메시지를 반환해야 한다.(브라우저 업데이트등)


**HTTP 명세에서 일반적인 인터셉트 프락시가 URI를 전달할때 절대 경로를 고쳐쓰는 것을 금지한다.**