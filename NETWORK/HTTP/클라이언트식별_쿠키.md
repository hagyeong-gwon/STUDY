# 클라이언트 식별과 쿠키


### 개별 접촉

HTTP는 익명으로 사용하며 상태가 없고 요청과 응답으로 통신하는 프로토콜이다.

*상태가 없음: 연결자체에 대한 정보를 가지지 않으며 매 요청은 일회성이고 독립적으로 처리된다.*

웹 서버는 요청을 보낸 사용자를 식별 하고 사용자의 요청을 추적하기 위해 약간의 정보를 이용한다
 ex) 쇼핑몰이 사용자 맞춤 추천 , 불필요한 정보를 매번 입력하는것 방지  

 ## 1. HTTP 헤더

 - From 헤더 

 From 헤더는 사용자의 이메일 주소를 포함한다 -> From 헤더로 사용자를 식별할 수 있다.
그러나 악의적으로 서버가 이메일 주소를 모아 스팸메일 보내는 경우가 있어 From 헤더를 보내는 브라우저는 많지 않다.

- User-Agent 헤더  

User-Agent 헤더는 사용자가 쓰고 있는 브라우저의 이름과 버전, 어떤 경우에는 운영체제에 대한 정보까지 서버에 보낸다. 그러나 특정 사용자를 식별하는데는 큰 도움이 되지 않는다  

- Referer 헤더  

 Referer 헤더는 현제 페이지로 유입하게 한 웹페이지의 URL을 가리킨다.  
사용자가 이전에 어떤 페이지를 방문함을 알수 있어 사용자의 취향을 알 수 있다.  그러나 사용자를 확실히 식별하기에는 부족하다.

## 2. 클라이언트 IP 주소

초기에 웹 선구자들은 사용자 식별에 클라이언트의 IP 주소를 사용하려 했다.

문제점

- 클라이언트 IP 주소는 사용자가 아닌 사용하는 컴퓨터를 가리킨다. 따라서 여러 사용자가 같은 컴푸터를 사용한다면 식별할 수 없다.
- 사용자가 로그인하면 동적으로 IP 주소를 할당하기 때문에 사용자는 매번 다른 주소를 받아 IP 주소로 식별 불가능하다
- 방화벽을 사용해 클라이언트의 실제 IP 주소가 아닌 하나의 방화벽 IP 주소로 변환한다.
- HTTP 프락시와 게이트 웨이는 원 서버에 새로운 TCP 연결을 한다
- 웹 서버는 클라이언트의 IP 주소가 아닌 프락시 서버의 IP 주소를 본다.


## 3. 사용자 로그인

- IP 주소로 사용자슬 식별하는 것보다 사용자에게 인증을 요구 해서 
  명시적으로 식별 요청을 할 수 있다.

- 서버에서 사용자가 사이트가 접근하기 전에 로그인을 시키자고 한다면 HTTP 401 Login 
  Required 응답 코드를 브라우저에 보낸다.

- 다음 요청부터 Authorization 헤더에 그 정보를 기술하여 보낸다.

![image](https://user-images.githubusercontent.com/70934609/110251091-2a993a00-7fc2-11eb-89c6-d1499b499d77.png)


## 4.뚱뚱한 URL

- URL 경로의 처음과 끝에 어떤 상태 정보를 추가해 확장한다.

- 사용자의 상태 정보를 포함하고 있는 URL을 뚱뚱한 URL 이라고 한다.  

문제점

- 못생긴 URL은 사용자에게 혼란을 준다.
- 공유하지 못하는 URL이다. URL을 공유하면 내 누적정보를 상대가 볼 수 있다.
- URL이 달라지기 때문에 기존 캐시에 접근할 수 없다.
- 서버 부하 과중이 될 수 있다.
- 의도치 않게 뚱뚱한 URL 세션에서 벗어날 확률이 높다.
- 로그아웃하면 모든 정보를 잃는다.

## 5. 쿠키

- 쿠키는 사용자를 식별하고 세션을 유지하는 방식 중 가장 널리 사용되는 방법  
- 쿠키는 매우 중요하고, 새로운 HTTP 헤더를 정의한다.  
- 대부분의 캐시나 브라우저는 쿠키에 있는 내용물을 캐싱하지 않는다.

### 세션 쿠키

사용자의 선호사항을 저장하는 임시 쿠키이다. 세션 쿠키는 사용자가 브라우저를 닫으면 삭제된다.


### 지속 쿠키

지속 쿠키는 디스크에 저장되어, 브라우저를 닫거나 PC를 재시작 하더라도 남아있다.

***세션쿠키와 지속 쿠키의 다른 점은 파기되는 시점 뿐이다.***


쿠키의 기본적인 발상은 브라우저가 서버 관련 정보를 저장하고 사용자가 해당 서버에 접근할때 그 정보를 함께 전송한다.

![image](https://user-images.githubusercontent.com/70934609/110251451-d1320a80-7fc3-11eb-8774-157a22d9e887.png)

- 브라우저는 쿠키를 저장할 책임이 있다 = 이를 '클라이언트 측 상태' 라고 한다.

*쿠키 전부를 모든 사이트에 보내는 것이 아니라 보통 각 사이트에 두 개 혹은 세 개의 쿠키만을 보냄*

**WHY?**

- 쿠키를 모두 전달하면 성능이 크게 저하된다.

- 쿠키 대부분은 서버에 특화된 이름/값 쌍을 포함하고 있기 때문에, 대부분에 사이트에서는 인식하지 않는 무의미한 값

- 모든 사이트에 쿠키를 전달하는 것은 잠재적인 개인정보 문제를 일으킨다.


쿠키 domain 속성 : Set-cookie 응답 헤더에 Domain 속성을 기술한다.

Set-cookie : user="mary17"; domain = "airtravlebargains.com"
이는 user=mary17 라는 쿠키를 .airtravlebargains.com 도메인을 가진 모든 사이트에 전달함을 의미한다.

쿠키 Path 속성 : Url 경로의 앞부분을 가리키는 Path 속성을 기술해서 해당 경로에 속하는 페이지에만 쿠키를 전달한다.  