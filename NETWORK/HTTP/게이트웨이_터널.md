# 게이트웨이

게이트웨이는 웹 페이지에 더 복잡한 리소스를 띄우기 위해, 리소스를 여러 어플리케이션에서 받아오기 위해 사용한다.

게이트웨이는 리소스와 애플리케이션을 연결하는 역할을 한다. 애플리케이션은 게이트웨이에게 요청을 처리해달라고 할 수 있고, 게이트웨이는 그에 응답할 수 있다. 동적인 컨텐츠를 생성하거나 데이터베이스 질의를 보낼 수도 있다.

게이트웨이는 HTTP 트래픽을 다른 프로토콜로 자동으로 변환하여, HTTP 클라이언트가 다른 프로토콜을 알 필요 없이 서버에 접속할 수 있게 하기도 한다.

![image](https://user-images.githubusercontent.com/70934609/109694798-8cc2fb00-7bce-11eb-9fc2-aee9d1a575b3.png)

### 클라이언트 측 게이트웨이와 서버 측 게이트웨이

**웹 게이트웨이는 한쪽에서는 HTTP로 통신하고, 다른 한쪽에서는 HTTP가 아닌 다른 프로토콜로 통신한다.**

![image](https://user-images.githubusercontent.com/70934609/109694979-b8de7c00-7bce-11eb-8116-5b938a6886d5.png)


a. 게이트웨이는 FTP URL을 가리키는 HTTP 요청을 받는다. 게이트웨이는 FTP 커넥션을 맺고 FTP 서버에 적절한 명령을 전송한다.

b. 게이트웨이는 암호화된 웹 요청을 SSL을 통해 받고, 요청을 해독해서 생성한 일반 HTTP 요청을 목적지 서버로 전달한다.

c. 게이트웨이는 애플리케이션 서버 게이트웨이 API를 통해서 HTTP 클라이언트를 서버 측 애플리케이션 프로그램에 연결한다. 웹에서 물건을 사거나 일기예보를 보거나 주식시세를 볼 때, 사실은 애플리케이션 서버 게이트웨이를 방문하는 것이다.

- 서버 측 게이트웨이는 클라이언트와 HTTP로 통신하고, 서버와는 외래 프로토콜로 통신한다.

- 클라이언트 측 게이트웨이는 클라이언트와 외래 프로토콜로 통신하고, 서버와는 HTTP로 통신한다.

## 프로토콜 게이트웨이

프록시에 트래픽을 바로 보내는 것과 같이 게이트웨이에도 HTTP 트래픽을 바로 보낼 수 있다.

보통 브라우저에 명시적으로 게이트웨이를 설정하여 자연스럽게 트래픽이 게이트웨이를 거쳐 가게 하거나, 게이트웨이를 대리 서버(리버스 프록시)로 설정할 수도 있다.


### HTTP/*: 서버 측 웹 게이트웨이

서버 측 웹 게이트웨이는 클라이언트로부터 HTTP 요청이 원 서버 영역으로 들어오는 시점에 클라이언트 측의 HTTP 요청을 외래 프로토콜로 전환한다.
이후 객체를 받는 대로 HTTP 응답에 실어서 클라이언트에 전송할 것이다

### HTTP/HTTPS: 서버 측 보안 게이트웨이

기업 내부의 모든 웹 요청을 암호화함으로써 개인 정보 보호와 보안을 제공하는데 게이트웨이를 사용할 수 있다. 클라이언트는 일반 HTTP를 사용하여 웹을 탐색할 수 있지만, 게이트웨이는 자동으로 사용자의 모든 세션을 암호화할 것이다.

![image](https://user-images.githubusercontent.com/70934609/109696549-8766b000-7bd0-11eb-84e4-7b2873b26b36.png)


### HTTPS/HTTP: 클라이언트 측 보안 가속 게이트웨이

HTTPS/HTTP 게이트웨이는 보안 가속기로 유명하다. 웹 서버의 앞단에 위치하고, 보이지 않는 인터셉트 게이트웨이나 리버스 프록시 역할을 한다. 이 게이트웨이는 보안 HTTPS 트래픽을 받아서 복호화하고, 웹 서버로 보낼 일반 HTTP 요청을 만든다.

HTTPS/HTTP 게이트웨이는 원 서버보다 더욱 효율적으로 보안 트래픽을 복호화하는 암호화 하드웨어를 내장하여 원 서버의 부하를 줄여주기도 한다.

하지만 게이트웨이와 원 서버 간의 암호화하지 않은 트래픽을 전송하기에, 둘 사이의 안전한 네트워크가 필요로 된다.

## 리소스 게이트웨이

게이트웨이의 가장 일반적인 형태인 애플리케이션 서버는 목적지 서버와 게이트웨이를 한 개의 서버로 결합한다.

애플리케이션 서버는 HTTP를 통해서 클라이언트와 통신하고, 서버 측에 있는 애플리케이션 프로그램에 연결하는 서버 측 게이트웨이이다.

애플리케이션 게이트웨이에서 유명했던 최초의 API는 공용 게이트웨이 인터페이스(Common Gateway Interface, CGI)였다. CGI는 특정 URL에 대한 HTTP 요청에 따라 프로그램을 실행하고, 프로그램의 출력을 수집하여 HTTP 응답으로 회신하는데 웹서버가 사용하는 표준화된 인터페이스 집합이다.

### 공용 게이트웨이 인터페이스

공용 게이트웨이 인터페이스(CGI)는 최초의 서버 확장이자, 지금까지도 가장 널리 쓰이는 서버 확장이다. 이는 웹에서 동적인 HTML, 신용카드 처리, 데이터베이스 질의 등을 제공하는 데 사용한다.


# 터널

웹 터널은 HTTP 프로토콜을 지원하지 않는 애플리케이션에 HTTP 애플리케이션을 사용해 접근하는 방법을 제공한다.

1. CONNECT로 HTTP 터널 커넥션 맺기

*CONNECT 메서드는 터널 게이트웨이가 임의의 목적 서버와 포트에 TCP 커넥션을 맺고 클라이언트와 서버 간에 오는 데이터를 무조건 전달하기를 요청한다.*

2. SSL 터널링

![image](https://user-images.githubusercontent.com/70934609/109699695-348ef780-7bd4-11eb-91c0-7e9b3d21a7d7.png)


*웹 터널은 원래 방화벽을 통해서 암호화된 SSL 트래픽을 전달하려고 개발되었다. 터널을 사용하면 SSL 트래픽을 HTTP 커넥션으로 전송하여 80 포트의 HTTP만 허용하는 방화벽을 통과할 수 있다.*

### SSL 터널링 vs HTTP/HTTPS 게이트웨이

- 클라이언트-게이트웨이 사이에는 보안이 적용되지 않은 일반 HTTP 커넥션이 맺어진다.
프록시가 인증을 담당하고 있기에, 클라이언트는 원격 서버에 SSL 클라이언트 인증(X509 인증서 기반)을 할 수 없다.

- 게이트웨이는 SSL을 완벽히 지원해야 한다.

이 상황에서 SSL 터널링을 사용하면, 프록시에 SSL을 구현할 필요가 없다. SSL 세션은 클라이언트가 생성한 요청과 목적지 웹 서버 간에 생선된다.

프록시 서버는 트랜잭션의 보안에는 관여하지 않고 암호화된 데이터를 그대로 터널링할 뿐이다.